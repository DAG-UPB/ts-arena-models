name: ${COMPOSE_PROJECT_NAME}

services:
  master-controller-api:
    build: ./master-controller
    command: uvicorn api:app --host 0.0.0.0 --port 8000
    ports:
      - "${MASTER_API_PORT}:8000"
    environment:
      - DOCKER_HOST=http://docker-proxy:2375
      - TARGET_LABEL=managed.by=controller
      - COMPOSE_PROJECT_NAME=${COMPOSE_PROJECT_NAME}
    networks:
      - internal
    depends_on:
      - docker-proxy

  docker-proxy:
    image: tecnativa/docker-socket-proxy:latest
    environment:
      - CONTAINERS=1
      - ALLOW_START=1
      - ALLOW_STOP=1
      - ALLOW_RESTARTS=1
      - IMAGES=0
      - NETWORKS=0
      - VOLUMES=0
      - POST=1
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - internal

include:
  - compose/chronos.yml
  - compose/timesfm.yml
  - compose/moirai.yml
  - compose/time-moe.yml
  - compose/moment.yml
  - compose/sundial.yml
  - compose/statistical.yml
  - compose/neuralforecast.yml
  - compose/flowstate.yml
  - compose/tinytimemixer.yml
  - compose/tirex.yml
  - compose/visionts.yml

volumes:
  arena-db:

networks:
  default:
  internal:
    driver: bridge